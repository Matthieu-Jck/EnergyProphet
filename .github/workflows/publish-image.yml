name: Publish Docker images to GHCR
on:
push:
branches: [ main, master ]
workflow_dispatch: {}


permissions:
contents: read
packages: write
id-token: write


jobs:
build-and-push:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4


- name: Set up QEMU
uses: docker/setup-qemu-action@v2


- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v2


- name: Log in to GHCR
uses: docker/login-action@v2
with:
registry: ghcr.io
username: ${{ github.actor }}
password: ${{ secrets.GITHUB_TOKEN }}


- name: Build and push backend image
uses: docker/build-push-action@v4
with:
context: ./backend
file: ./backend/Dockerfile
platforms: linux/amd64,linux/arm64
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/energyprophet-backend:latest
ghcr.io/${{ github.repository_owner }}/energyprophet-backend:${{ github.sha }}


- name: Build and push frontend image
uses: docker/build-push-action@v4
with:
context: ./frontend
file: ./frontend/Dockerfile
platforms: linux/amd64,linux/arm64
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/energyprophet-frontend:latest
ghcr.io/${{ github.repository_owner }}/energyprophet-frontend:${{ github.sha }}